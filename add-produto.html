<!DOCTYPE html>
<html lang="pt-BR">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <meta name="google-adsense-account" content="ca-pub-4531749081462125">
Â  <meta http-equiv="Content-Security-Policy" content="
Â  Â  default-src 'self';
Â  Â  script-src 'self' 'unsafe-inline' https://pagead2.googlesyndication.com https://www.gstatic.com;
Â  Â  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com;
Â  Â  img-src 'self' data: https://*.googleusercontent.com https://firebasestorage.googleapis.com https://res.cloudinary.com;
Â  Â  font-src 'self' https://fonts.gstatic.com;
Â  Â  connect-src 'self' https://api.cloudinary.com https://script.google.com https://script.googleusercontent.com;
Â  ">
Â  <title>Centro de Compras - AdministraÃ§Ã£o</title>
Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
Â  <link rel="stylesheet" href="/style.css" media="print" onload="this.media='all'">
Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" media="print" onload="this.media='all'">
Â  <link rel="icon" type="image/x-icon" href="/logos/favicon.ico">
Â  <link rel="icon" type="image/png" sizes="32x32" href="/logos/favicon-32x32.png">
Â  <link rel="icon" type="image/png" sizes="16x16" href="/logos/favicon-16x16.png">
Â  <link rel="apple-touch-icon" sizes="180x180" href="/logos/apple-touch-icon.png">
</head>
<body>
Â  <header class="site-header">
Â  Â  <div class="logo-container">
Â  Â  Â  <img src="/logos/logoscentrodecompras.jpeg" alt="Centro de Compras" id="site-logo-img" width="150" height="50">
Â  Â  </div>
Â  Â  <div class="header-text">
Â  Â  Â  <h1>Centro de Compra - AdministraÃ§Ã£o</h1>
Â  Â  Â  <p>Gerencie os produtos do portal</p>
Â  Â  </div>
Â  </header>

Â  <nav>
Â  Â  <a href="/index.html">Voltar para PromoÃ§Ãµes</a>
Â  Â  <a href="/cupom.html">Cupom de Desconto</a>
Â  Â  <a href="/sobre.html">Sobre</a>
Â  Â  <a href="/contato.html">AdministraÃ§Ã£o</a>
Â  </nav>

Â  <main>
Â  Â  <section class="cadastro">
Â  Â  Â  <h2>Cadastro de Produtos</h2>
Â  Â  Â  <form id="form-produto">
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="nome">Nome do Produto:</label>
Â  Â  Â  Â  Â  <input type="text" id="nome" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="descricao">DescriÃ§Ã£o:</label>
Â  Â  Â  Â  Â  <textarea id="descricao" required></textarea>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="categoria">Categoria:</label>
Â  Â  Â  Â  Â  <select id="categoria" required>
Â  Â  Â  Â  Â  Â  <option value="">Selecione uma categoria</option> Â  Â  Â  Â  Â  Â  <option value="eletronicos">EletrÃ´nicos</option>
Â  Â  Â  Â  Â  Â  <option value="moda">Moda</option>
Â  Â  Â  Â  Â  Â  <option value="fitness">Fitness</option>
Â  Â  Â  Â  Â  Â  <option value="casa">Casa</option>
Â  Â  Â  Â  Â  Â  <option value="beleza">Beleza</option>
Â  Â  Â  Â  Â  Â  <option value="esportes">Esportes</option>
Â  Â  Â  Â  Â  Â  <option value="livros">Livros</option>
Â  Â  Â  Â  Â  Â  <option value="infantil">Infantil</option>
Â  Â  Â  Â  Â  Â  <option value="celulares">Celulares</option>
Â  Â  Â  Â  Â  Â  <option value="eletrodomesticos">EletrodomÃ©sticos</option>
Â  Â  Â  Â  Â  Â  <option value="pet">Pet</option>
Â  Â  Â  Â  Â  Â  <option value="jardinagem">Jardinagem</option>
Â  Â  Â  Â  Â  Â  <option value="automotivo">Automotivo</option>
Â  Â  Â  Â  Â  Â  <option value="gastronomia">Gastronomia</option>
Â  Â  Â  Â  Â  Â  <option value="games">Games</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="preco">PreÃ§o (R$):</label>
Â  Â  Â  Â  Â  <input type="number" id="preco" step="0.01" min="0" required> Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="imagem">Imagem:</label>
Â  Â  Â  Â  Â  <input type="file" id="imagem" accept="image/*" required>
Â  Â  Â  Â  Â  <img id="preview" style="display: none; max-width: 200px; margin-top: 10px;" alt="PrÃ©-visualizaÃ§Ã£o da imagem do produto">
Â  Â  Â  Â  Â  <div class="loading-spinner" id="image-upload-spinner" style="display: none;">
Â  Â  Â  Â  Â  Â  <i class="fas fa-spinner fa-spin"></i> Enviando imagem...
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="link">Link do Produto:</label>
Â  Â  Â  Â  Â  <input type="url" id="link" placeholder="https://www.exemplo.com" required>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  <button type="submit" id="submit-button">Cadastrar Produto</button>
Â  Â  Â  </form>
Â  Â  Â  <div id="feedback" class="feedback"></div>
Â  Â  </section>
Â  </main>

Â  <footer>
Â  Â  <p>ðŸ”§ Todos os direitos reservados <strong>Grupo Centro de Compra "CdC"</strong> Â© <span id="year"></span></p>
Â  </footer>

Â  <script>
Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  // Define o ano no footer
Â  Â  Â  document.getElementById('year').textContent = new Date().getFullYear();

Â  Â  Â  // --- ATENÃ‡ÃƒO: SISTEMA DE AUTENTICAÃ‡ÃƒO NECESSÃRIO ---
Â  Â  Â  // O acesso a esta pÃ¡gina DEVE ser protegido por um sistema de autenticaÃ§Ã£o robusto.
Â  Â  Â  // O token 'triple-click-access' nÃ£o oferece seguranÃ§a real.
Â  Â  Â  // Exemplo de um redirecionamento simples (apenas para demonstraÃ§Ã£o, nÃ£o seguro):
Â  Â  Â  // const urlParams = new URLSearchParams(window.location.search);
Â  Â  Â  // const tempToken = urlParams.get('tempToken');
Â  Â  Â  // if (tempToken !== 'seu_token_realmente_secreto_e_gerado_no_backend_por_login_seguro') {
Â  Â  Â  // Â  alert('Acesso nÃ£o autorizado! Redirecionando para a pÃ¡gina inicial.');
Â  Â  Â  // Â  window.location.href = '/index.html';
Â  Â  Â  // Â  return;
Â  Â  Â  // }
Â  Â  Â  // ---------------------------------------------------

Â  Â  Â  // JavaScript do formulÃ¡rio
Â  Â  Â  const cloudName = 'centrodecompra';
Â  Â  Â  const unsignedUploadPreset = 'ml_default';
Â  Â  Â  // ATENÃ‡ÃƒO: Substitua pela URL REAL do seu Google Apps Script implantado
Â  Â  Â  const appsScriptUrl = 'https://script.google.com/macros/s/AKfycbz7uNcWDWh0ojLXDeVfFHbv9_DSAee5LCcUr1Qitopz/exec';

Â  Â  Â  const form = document.getElementById('form-produto');
Â  Â  Â  const imagemInput = document.getElementById('imagem');
Â  Â  Â  const preview = document.getElementById('preview');
Â  Â  Â  const feedback = document.getElementById('feedback');
Â  Â  Â  const submitButton = document.getElementById('submit-button');
Â  Â  Â  const imageUploadSpinner = document.getElementById('image-upload-spinner');
Â  Â  Â  
Â  Â  Â  let imagemUrl = '';
Â  Â  Â  let isUploadingImage = false; // Flag para controlar o upload da imagem

Â  Â  Â  imagemInput.addEventListener('change', async (e) => {
Â  Â  Â  Â  const file = e.target.files[0];
Â  Â  Â  Â  if (!file) return;

Â  Â  Â  Â  // Resetar feedback visual
Â  Â  Â  Â  feedback.textContent = '';
Â  Â  Â  Â  preview.style.display = 'none';
Â  Â  Â  Â  submitButton.disabled = true; // Desabilitar botÃ£o enquanto a imagem Ã© enviada
Â  Â  Â  Â  imageUploadSpinner.style.display = 'block'; // Mostrar spinner
Â  Â  Â  Â  isUploadingImage = true;

Â  Â  Â  Â  const formData = new FormData();
Â  Â  Â  Â  formData.append('file', file);
Â  Â  Â  Â  formData.append('upload_preset', unsignedUploadPreset);

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  body: formData
Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  if (!res.ok) throw new Error('Erro ao enviar imagem para o Cloudinary');

Â  Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  Â  imagemUrl = data.secure_url;
Â  Â  Â  Â  Â  preview.src = imagemUrl;
Â  Â  Â  Â  Â  preview.style.display = 'block';
Â  Â  Â  Â  Â  feedback.textContent = 'Imagem carregada com sucesso!';
Â  Â  Â  Â  Â  feedback.style.color = 'green';
Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  imagemUrl = ''; // Limpa a URL se houver erro
Â  Â  Â  Â  Â  feedback.textContent = 'Erro ao enviar imagem! Tente novamente.';
Â  Â  Â  Â  Â  feedback.style.color = 'red';
Â  Â  Â  Â  Â  console.error(err);
Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  imageUploadSpinner.style.display = 'none'; // Esconder spinner
Â  Â  Â  Â  Â  isUploadingImage = false;
Â  Â  Â  Â  Â  submitButton.disabled = false; // Reabilitar o botÃ£o de submissÃ£o
Â  Â  Â  Â  }
Â  Â  Â  });

Â  Â  Â  form.addEventListener('submit', async (e) => {
Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  // Verificar se o upload da imagem ainda estÃ¡ em andamento
Â  Â  Â  Â  if (isUploadingImage) {
Â  Â  Â  Â  Â  feedback.textContent = 'Aguarde o envio da imagem antes de cadastrar o produto!';
Â  Â  Â  Â  Â  feedback.style.color = 'orange';
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  if (!imagemUrl) {
Â  Â  Â  Â  Â  feedback.textContent = 'Por favor, selecione e aguarde o upload da imagem.';
Â  Â  Â  Â  Â  feedback.style.color = 'red';
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const nome = document.getElementById('nome').value.trim();
Â  Â  Â  Â  const descricao = document.getElementById('descricao').value.trim();
Â  Â  Â  Â  const categoria = document.getElementById('categoria').value;
Â  Â  Â  Â  const preco = parseFloat(document.getElementById('preco').value);
Â  Â  Â  Â  const link = document.getElementById('link').value.trim();

Â  Â  Â  Â  // ValidaÃ§Ã£o frontend mais especÃ­fica
Â  Â  Â  Â  if (!nome) {
Â  Â  Â  Â  Â  feedback.textContent = 'O nome do produto Ã© obrigatÃ³rio.';
Â  Â  Â  Â  Â  feedback.style.color = 'red';
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  if (!descricao) {
Â  Â  Â  Â  Â  feedback.textContent = 'A descriÃ§Ã£o do produto Ã© obrigatÃ³ria.';
Â  Â  Â  Â  Â  feedback.style.color = 'red';
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  if (!categoria || categoria === '') {
Â  Â  Â  Â  Â  feedback.textContent = 'Selecione uma categoria para o produto.';
Â  Â  Â  Â  Â  feedback.style.color = 'red';
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  if (isNaN(preco) || preco < 0) {
Â  Â  Â  Â  Â  feedback.textContent = 'PreÃ§o invÃ¡lido! Deve ser um nÃºmero positivo.';
Â  Â  Â  Â  Â  feedback.style.color = 'red';
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  if (!link) {
Â  Â  Â  Â  Â  feedback.textContent = 'O link do produto Ã© obrigatÃ³rio.';
Â  Â  Â  Â  Â  feedback.style.color = 'red';
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const urlPattern = /^(https?:\/\/[^\s$.?#].[^\s]*)$/;
Â  Â  Â  Â  if (!urlPattern.test(link)) {
Â  Â  Â  Â  Â  feedback.textContent = 'Link invÃ¡lido! Deve ser uma URL iniciando com http ou https.';
Â  Â  Â  Â  Â  feedback.style.color = 'red';
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const produto = {
Â  Â  Â  Â  Â  nome,
Â  Â  Â  Â  Â  descricao,
Â  Â  Â  Â  Â  categoria,
Â  Â  Â  Â  Â  preco,
Â  Â  Â  Â  Â  imagem: imagemUrl,
Â  Â  Â  Â  Â  link
Â  Â  Â  Â  };

Â  Â  Â  Â  // Desabilita o botÃ£o para evitar mÃºltiplos cliques
Â  Â  Â  Â  submitButton.disabled = true;
Â  Â  Â  Â  feedback.textContent = 'Cadastrando produto...';
Â  Â  Â  Â  feedback.style.color = 'blue';

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  const response = await fetch(appsScriptUrl, {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  body: JSON.stringify(produto),
Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json'
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  const result = await response.json();

Â  Â  Â  Â  Â  if (result.status === 'success') {
Â  Â  Â  Â  Â  Â  feedback.textContent = 'Produto cadastrado com sucesso!';
Â  Â  Â  Â  Â  Â  feedback.style.color = 'green';
Â  Â  Â  Â  Â  Â  form.reset(); // Limpa o formulÃ¡rio
Â  Â  Â  Â  Â  Â  preview.src = '';
Â  Â  Â  Â  Â  Â  preview.style.display = 'none';
Â  Â  Â  Â  Â  Â  imagemUrl = ''; // Limpa a URL da imagem
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  feedback.textContent = `Erro ao cadastrar produto: ${result.message}`;
Â  Â  Â  Â  Â  Â  feedback.style.color = 'red';
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  feedback.textContent = 'Erro de conexÃ£o ou servidor ao cadastrar produto!';
Â  Â  Â  Â  Â  feedback.style.color = 'red';
Â  Â  Â  Â  Â  console.error(err);
Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  submitButton.disabled = false; // Reabilita o botÃ£o de submissÃ£o
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  });
Â  </script>
</body>
</html>
