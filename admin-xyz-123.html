<!DOCTYPE html>
<html lang="pt-br">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <meta name="description" content="Painel administrativo para gerenciar produtos do Centro de Compras.">
 <meta property="og:title" content="Centro de Compras - Painel Admin">
 <meta property="og:description" content="Gerencie produtos do Centro de Compras com facilidade.">
 <meta property="og:image" content="/logos/centrodecompras.jpg">
 <meta property="og:url" content="https://www.centrodecompra.com.br/admin-xyz-123.html">
 <meta name="twitter:card" content="summary_large_image">
 <title>Centro de Compras - Painel Admin</title>
 <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
 <link rel="stylesheet" href="/style.css">
 <style>
 body {
 font-family: 'Roboto', sans-serif;
 margin: 0;
 padding: 0;
 background: #f5f5f5;
 }
 header {
 background: #FFA500;
 color: #fff;
 padding: 15px;
 text-align: center;
 }
 header h1 {
 margin: 0;
 font-size: 24px;
 }
 .admin-container {
 max-width: 1200px;
 margin: 20px auto;
 padding: 0 15px;
 }
 .form-section, .produtos-section {
 background: #fff;
 padding: 20px;
 border-radius: 8px;
 box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
 margin-bottom: 20px;
 }
 .form-section h2, .produtos-section h2 {
 color: #2E8B57;
 margin-top: 0;
 }
 .form-group {
 margin-bottom: 15px;
 }
 .form-group label {
 display: block;
 margin-bottom: 5px;
 font-weight: bold;
 }
 .form-group input, .form-group select, .form-group textarea {
 width: 100%;
 padding: 8px;
 border: 1px solid #ccc;
 border-radius: 4px;
 font-size: 14px;
 }
 .form-group input[type="file"] {
 padding: 3px;
 }
 .form-group textarea {
 resize: vertical;
 min-height: 100px;
 }
 .form-buttons {
 display: flex;
 gap: 10px;
 }
 .form-buttons button {
 background: #ff6200;
 color: #fff;
 border: none;
 padding: 10px 20px;
 border-radius: 4px;
 cursor: pointer;
 font-size: 14px;
 min-width: 44px;
 touch-action: manipulation;
 }
 .form-buttons button:hover {
 background: #e55b00;
 }
 #loading-spinner {
 display: none;
 text-align: center;
 margin: 20px 0;
 }
 #error-message {
 display: none;
 color: #ff0000;
 margin: 10px 0;
 text-align: center;
 }
 .grid-produtos {
 display: grid;
 grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
 gap: 15px;
 }
 .produto-card {
 background: #fff;
 border: 1px solid #ddd;
 border-radius: 8px;
 padding: 10px;
 text-align: center;
 }
 .produto-card img {
 width: 120px;
 height: 120px;
 object-fit: contain;
 margin-bottom: 10px;
 }
 .produto-card .image-error {
 color: #ff0000;
 font-size: 12px;
 margin-bottom: 10px;
 display: none;
 }
 .produto-card .produto-nome {
 font-size: 16px;
 font-weight: bold;
 color: #333;
 margin-bottom: 5px;
 }
 .produto-card .descricao {
 font-size: 12px;
 color: #666;
 margin-bottom: 10px;
 }
 .produto-card .tarja-preco {
 background: #ff6200;
 color: #fff;
 padding: 8px;
 border-radius: 4px;
 text-decoration: none;
 display: inline-block;
 font-size: 11px;
 min-width: 44px;
 }
 .produto-card .editar, .produto-card .excluir {
 background: #2E8B57;
 color: #fff;
 border: none;
 padding: 8px;
 border-radius: 4px;
 cursor: pointer;
 margin: 5px;
 font-size: 11px;
 min-width: 44px;
 }
 .produto-card .excluir {
 background: #ff0000;
 }
 @media (max-width: 768px) {
 .grid-produtos {
 grid-template-columns: repeat(2, 1fr);
 gap: 10px;
 }
 .produto-card img {
 width: 100px;
 height: 100px;
 }
 header h1 {
 font-size: 20px;
 }
 .form-buttons {
 flex-direction: column;
 gap: 5px;
 }
 .form-buttons button {
 width: 100%;
 }
 }
 img[src="/imagens/placeholder.jpg"] {
 border: 1px solid #ff6200;
 opacity: 0.7;
 }
 </style>
 <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
 <header>
 <h1>Painel Administrativo - Centro de Compras</h1>
 </header>
 <div class="admin-container">
 <div class="form-section">
 <h2>Adicionar/Editar Produto</h2>
 <form id="form-produto">
 <div class="form-group">
 <label for="nome">Nome do Produto</label>
 <input type="text" id="nome" name="nome" required>
 </div>
 <div class="form-group">
 <label for="preco">Preço</label>
 <input type="number" id="preco" name="preco" step="0.01" required>
 </div>
 <div class="form-group">
 <label for="categoria">Categoria</label>
 <select id="categoria" name="categoria" required>
 <option value="eletronicos">Eletrônicos</option>
 <option value="moda">Moda</option>
 <option value="casa">Casa e Decoração</option>
 <option value="esportes">Esportes e Fitness</option>
 <option value="livros">Livros</option>
 <option value="beleza">Beleza e Cuidados Pessoais</option>
 <option value="brinquedos">Brinquedos e Jogos</option>
 <option value="alimentos">Alimentos e Bebidas</option>
 <option value="automotivo">Automotivo</option>
 <option value="saude">Saúde e Bem-Estar</option>
 <option value="informatica">Informática</option>
 <option value="bebes">Bebês</option>
 <option value="joias">Joias e Acessórios</option>
 <option value="pet">Pet</option>
 <option value="outros">Outros</option>
 </select>
 </div>
 <div class="form-group">
 <label for="loja">Loja</label>
 <select id="loja" name="loja" required>
 <option value="Amazon">Amazon</option>
 <option value="Magalu">Magalu</option>
 <option value="Shein">Shein</option>
 <option value="Shopee">Shopee</option>
 <option value="Mercado Livre">Mercado Livre</option>
 <option value="Alibaba">Alibaba</option>
 </select>
 </div>
 <div class="form-group">
 <label for="link">Link do Produto</label>
 <input type="url" id="link" name="link" required>
 </div>
 <div class="form-group">
 <label for="imagens">Imagens (máx. 5MB cada)</label>
 <input type="file" id="imagens" name="imagens" accept="image/jpeg,image/png" multiple>
 </div>
 <div class="form-group">
 <label for="descricao">Descrição</label>
 <textarea id="descricao" name="descricao"></textarea>
 </div>
 <div class="form-buttons">
 <button type="submit" id="submit-btn">Adicionar Produto</button>
 <button type="button" id="cancel-btn" style="display: none;">Cancelar Edição</button>
 </div>
 </form>
 <div id="loading-spinner">
 <i class="fas fa-spinner fa-spin"></i> Carregando...
 </div>
 <div id="error-message"></div>
 </div>
 <div class="produtos-section">
 <h2>Produtos Cadastrados</h2>
 <div id="grid-produtos" class="grid-produtos"></div>
 </div>
 </div>
 <script>
 const API_BASE_URL = 'https://minha-api-produtos.onrender.com';
 const socket = io(API_BASE_URL, { transports: ['websocket'] });
 let editingId = null;

 document.addEventListener('DOMContentLoaded', () => {
 console.log('DOMContentLoaded disparado no admin');

 // Manipulador de erro para imagens
 document.querySelectorAll('img').forEach(img => {
 img.onerror = () => {
 console.error(`Erro ao carregar imagem: ${img.src}`);
 img.src = '/imagens/placeholder.jpg';
 img.alt = 'Imagem indisponível';
 img.title = 'Imagem não pôde ser carregada';
 const card = img.closest('.produto-card');
 if (card) {
 const errorText = card.querySelector('.image-error') || document.createElement('p');
 errorText.className = 'image-error';
 errorText.textContent = 'Imagem não disponível';
 errorText.style.display = 'block';
 card.insertBefore(errorText, img.nextSibling);
 }
 };
 });

 // Carregar produtos
 carregarProdutos();

 // Configurar formulário
 const form = document.getElementById('form-produto');
 form.addEventListener('submit', adicionarOuEditarProduto);

 // Botão de cancelar edição
 document.getElementById('cancel-btn').addEventListener('click', () => {
 form.reset();
 editingId = null;
 document.getElementById('submit-btn').textContent = 'Adicionar Produto';
 document.getElementById('cancel-btn').style.display = 'none';
 });

 // Socket.IO para atualizações em tempo real
 socket.on('novoProduto', () => {
 console.log('Novo produto detectado, recarregando lista');
 carregarProdutos();
 });
 socket.on('produtoAtualizado', () => {
 console.log('Produto atualizado, recarregando lista');
 carregarProdutos();
 });
 socket.on('produtoExcluido', () => {
 console.log('Produto excluído, recarregando lista');
 carregarProdutos();
 });
 });

 async function fetchWithRetry(url, options, retries = 3, backoff = 1000) {
 for (let i = 0; i < retries; i++) {
 try {
 const response = await fetch(url, options);
 if (!response.ok) {
 if (response.status === 404) throw new Error('Recurso não encontrado');
 if (response.status === 500) throw new Error('Erro no servidor');
 throw new Error(`Erro ${response.status}: Falha na requisição`);
 }
 return await response.json();
 } catch (error) {
 console.error(`Tentativa ${i + 1} falhou: ${error.message}`);
 if (i === retries - 1) throw error;
 await new Promise(resolve => setTimeout(resolve, backoff * 
