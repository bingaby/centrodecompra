<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Centro de Compra</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Roboto', Arial, sans-serif; padding: 20px; background-color: #f5f5f5; }
    h1 { text-align: center; color: #333; }
    #controles { max-width: 800px; margin: 20px auto; display: flex; gap: 10px; flex-wrap: wrap; }
    select, input[type="text"], button { padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
    button { background-color: #ff6200; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #e55a00; }
    #grid-produtos { max-width: 800px; margin: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
    .produto-card { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; }
    .produto-card img { width: 100%; height: 150px; object-fit: cover; border-radius: 4px; }
    .produto-card h3 { font-size: 18px; margin: 10px 0; }
    .produto-card p { font-size: 14px; color: #666; }
    .botao-comprar { display: inline-block; padding: 10px; background-color: #ff6200; color: white; text-decoration: none; border-radius: 4px; }
    .botao-comprar:hover { background-color: #e55a00; }
    #mensagem-erro { color: red; text-align: center; margin: 10px 0; }
    #loading { display: none; text-align: center; margin: 10px 0; }
    #loading::after { content: 'Carregando...'; animation: dots 1s infinite; }
    @keyframes dots { 0%, 20% { content: 'Carregando.'; } 40% { content: 'Carregando..'; } 60% { content: 'Carregando...'; } }
  </style>
</head>
<body>
  <h1>Centro de Compra</h1>
  <div id="controles">
    <select id="filtro-categoria">
      <option value="">Todas as categorias</option>
    </select>
    <select id="filtro-loja">
      <option value="">Todas as lojas</option>
    </select>
    <input type="text" id="busca" placeholder="Buscar produtos...">
    <button id="atualizar-ofertas">Atualizar Ofertas</button>
  </div>
  <div id="mensagem-erro"></div>
  <div id="loading" class="loading"></div>
  <div id="grid-produtos"></div>

  <script>
    const JSON_URL = 'https://raw.githubusercontent.com/bingaby/centrodecompra/main/produtos.json';
    let produtos = [];

    async function carregarProdutos() {
      const mensagemErro = document.getElementById('mensagem-erro');
      const loading = document.getElementById('loading');
      try {
        loading.style.display = 'block';
        console.log('Carregando:', JSON_URL);
        const response = await fetch(JSON_URL, { cache: 'no-cache' });
        console.log('Resposta:', response.status, response.statusText);
        if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
        produtos = await response.json();
        atualizarGrid();
        atualizarFiltros();
        mensagemErro.textContent = produtos.length ? '' : 'Nenhum produto encontrado.';
      } catch (error) {
        console.error('Erro:', error);
        mensagemErro.textContent = 'Erro ao carregar produtos. Tente novamente.';
      } finally {
        loading.style.display = 'none';
      }
    }

    function atualizarGrid() {
      const grid = document.getElementById('grid-produtos');
      grid.innerHTML = '';
      if (!produtos.length) {
        grid.innerHTML = '<p>Nenhum produto encontrado.</p>';
        return;
      }
      produtos.forEach(produto => {
        const card = document.createElement('div');
        card.className = 'produto-card';
        const imagem = produto.imagens?.length ? produto.imagens[0] : 'https://via.placeholder.com/150';
        card.innerHTML = `
          <img src="${imagem}" alt="${produto.nome}">
          <h3>${produto.nome}</h3>
          <p>${produto.descricao}</p>
          <p><strong>Categoria:</strong> ${produto.categoria}</p>
          <p><strong>Loja:</strong> ${produto.loja}</p>
          <a href="${produto.link}" target="_blank" class="botao-comprar">Comprar</a>
        `;
        grid.appendChild(card);
      });
    }

    function atualizarFiltros() {
      const categorias = [...new Set(produtos.map(p => p.categoria))];
      const lojas = [...new Set(produtos.map(p => p.loja))];
      const filtroCategoria = document.getElementById('filtro-categoria');
      const filtroLoja = document.getElementById('filtro-loja');
      filtroCategoria.innerHTML = '<option value="">Todas as categorias</option>' +
        categorias.map(cat => `<option value="${cat}">${cat}</option>`).join('');
      filtroLoja.innerHTML = '<option value="">Todas as lojas</option>' +
        lojas.map(loja => `<option value="${loja}">${loja}</option>`).join('');
    }

    function filtrarProdutos() {
      const categoria = document.getElementById('filtro-categoria').value;
      const loja = document.getElementById('filtro-loja').value;
      const busca = document.getElementById('busca').value.toLowerCase();
      const filtered = produtos.filter(p =>
        (!categoria || p.categoria === categoria) &&
        (!loja || p.loja === loja) &&
        (p.nome.toLowerCase().includes(busca) || p.descricao.toLowerCase().includes(busca))
      );
      produtos = filtered;
      atualizarGrid();
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('atualizar-ofertas').addEventListener('click', carregarProdutos);
      document.getElementById('filtro-categoria').addEventListener('change', filtrarProdutos);
      document.getElementById('filtro-loja').addEventListener('change', filtrarProdutos);
      document.getElementById('busca').addEventListener('input', filtrarProdutos);
      carregarProdutos();
    });
  </script>
</body>
</html>
