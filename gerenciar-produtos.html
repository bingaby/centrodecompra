<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Gerenciar Produtos</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Adicionar Novo Produto</h1>
  <form id="productForm">
    <label>Nome do Produto:</label><br>
    <input type="text" id="name" required><br>
    <label>Preço (R$):</label><br>
    <input type="number" id="price" step="0.01" required><br>
    <label>Imagem Principal (URL):</label><br>
    <input type="url" id="image" required><br>
    <label>Imagens do Carrossel (URLs, separadas por vírgula):</label><br>
    <input type="text" id="images" placeholder="https://exemplo.com/img1.jpg,https://exemplo.com/img2.jpg"><br>
    <label>Descrição:</label><br>
    <textarea id="description"></textarea><br>
    <label>Categoria:</label><br>
    <select id="category" required>
      <option value="eletronicos">Eletrônicos</option>
      <option value="moda">Moda</option>
      <option value="fitness">Fitness</option>
      <option value="casa">Casa e Decoração</option>
      <option value="beleza">Beleza</option>
      <option value="esportes">Esportes</option>
      <option value="livros">Livros</option>
      <option value="infantil">Infantil</option>
      <option value="Celulares">Celulares</option>
      <option value="Eletrodomésticos">Eletrodomésticos</option>
    </select><br>
    <label>Loja:</label><br>
    <select id="store" required>
      <option value="amazon">Amazon</option>
      <option value="magalu">Magalu</option>
      <option value="shein">Shein</option>
      <option value="shopee">Shopee</option>
      <option value="mercadolivre">Mercado Livre</option>
      <option value="alibaba">Alibaba</option>
    </select><br>
    <label>Link de Afiliado:</label><br>
    <input type="url" id="link" required><br>
    <button type="submit">Adicionar Produto</button>
  </form>
  <a href="index.html">Voltar para a Página Principal</a>
  <script>
    document.getElementById('productForm').addEventListener('submit', async function(event) {
      event.preventDefault();

      const imagesInput = document.getElementById('images').value;
      const images = imagesInput ? imagesInput.split(',').map(url => url.trim()) : [];

      const product = {
        name: document.getElementById('name').value,
        price: parseFloat(document.getElementById('price').value),
        image: document.getElementById('image').value,
        images: images.length > 0 ? images : undefined,
        description: document.getElementById('description').value || undefined,
        category: document.getElementById('category').value,
        store: document.getElementById('store').value,
        link: document.getElementById('link').value
      };

      // Configurações da API do GitHub
      const token = 'ghp_seuTokenAqui'; // Substitua pelo seu token
      const repo = 'seu-usuario/nome-do-repositorio';
      const path = 'data/produtos.json';

      try {
        // Obter JSON atual
        const response = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
          headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });
        if (!response.ok) {
          throw new Error(`Erro ao obter produtos.json: ${response.status}`);
        }
        const data = await response.json();
        const currentProducts = JSON.parse(atob(data.content));

        // Adicionar novo produto
        currentProducts.push(product);

        // Atualizar JSON
        const updateResponse = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json'
          },
          body: JSON.stringify({
            message: 'Adicionar novo produto',
            content: btoa(JSON.stringify(currentProducts, null, 2)),
            sha: data.sha
          })
        });

        if (!updateResponse.ok) {
          throw new Error(`Erro ao atualizar produtos.json: ${updateResponse.status}`);
        }

        alert('Produto adicionado com sucesso! Pode demorar alguns minutos para aparecer na página principal.');
        document.getElementById('productForm').reset();
      } catch (error) {
        console.error('Erro ao adicionar produto:', error);
        alert('Erro ao adicionar produto. Verifique o console para detalhes.');
      }
    });
  </script>
</body>
</html>
