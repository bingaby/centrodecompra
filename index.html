<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Centro de Compra - Ofertas do Dia</title>
  <link rel="stylesheet" href="/style.css" />
  <script type="module" src="/index.js" defer></script>
</head>
<body>
  <header class="site-header">
    <div class="logo-container">
      <img src="/logos/logoscentrodecompras.jpeg" alt="Centro de Compras" id="site-logo-img" width="150" height="50" />
    </div>
    <div class="header-text">
      <h1>Centro de Compra</h1>
      <p>O maior portal de compras do Brasil! Encontre as melhores ofertas.</p>
    </div>
  </header>

  <nav>
    <a href="/index.html">Promo√ß√µes</a>
    <a href="/cupom.html">Cupom de Desconto</a>
    <a href="/sobre.html">Sobre</a>
    <a href="/contato.html">Contato</a>
  </nav>

  <div class="container">
    <aside class="sidebar">
      <h3>Categorias</h3>
      <ul id="lista-categorias">
        <!-- Categorias ser√£o adicionadas aqui -->
      </ul>
    </aside>

    <main>
      <section>
        <h2>üõçÔ∏è Ofertas do Dia</h2>
        <input type="text" id="busca" placeholder="Busque por produtos..." class="barra-busca" />
        <div id="busca-feedback" class="busca-feedback"></div>
        <div id="loading-spinner" class="loading-spinner" style="display:none;">
          <i class="fas fa-spinner fa-spin"></i> Carregando...
        </div>
        <div class="grid-produtos" id="grid-produtos"></div>
        <p class="mensagem-vazia" id="mensagem-vazia" style="display:none;">Nenhum produto encontrado.</p>
        <p class="error-message" id="error-message" style="display:none;"></p>
        <div class="paginacao" id="paginacao" style="margin-top: 20px;">
          <button id="prev-page" disabled>Anterior</button>
          <span id="page-info">P√°gina 1</span>
          <button id="next-page" disabled>Pr√≥xima</button>
        </div>
      </section>
    </main>
  </div>

  <footer>
    <p>üîß Todos os direitos reservados <strong>Grupo Centro de Compra "CdC"</strong> ¬© <span id="year"></span></p>
  </footer>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, query, where, getDocs, orderBy, limit, startAfter } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_AUTH_DOMAIN",
      projectId: "SEU_PROJECT_ID",
      storageBucket: "SEU_STORAGE_BUCKET",
      messagingSenderId: "SEU_MESSAGING_SENDER_ID",
      appId: "SEU_APP_ID",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // DOM Elements
    const gridProdutos = document.getElementById("grid-produtos");
    const mensagemVazia = document.getElementById("mensagem-vazia");
    const errorMessage = document.getElementById("error-message");
    const buscaInput = document.getElementById("busca");
    const loadingSpinner = document.getElementById("loading-spinner");
    const prevPageBtn = document.getElementById("prev-page");
    const nextPageBtn = document.getElementById("next-page");
    const pageInfo = document.getElementById("page-info");

    // Vari√°veis de controle
    let produtos = [];
    let filtroCategoria = "todas";
    let buscaTermo = "";
    let paginaAtual = 1;
    const produtosPorPagina = 12;

    // Fun√ß√£o para renderizar produtos na tela
    function renderizarProdutos(lista) {
      gridProdutos.innerHTML = "";
      if (lista.length === 0) {
        mensagemVazia.style.display = "block";
        return;
      }
      mensagemVazia.style.display = "none";

      for (const produto of lista) {
        const div = document.createElement("div");
        div.className = "produto-card";
        div.innerHTML = `
          <a href="${produto.link}" target="_blank" rel="noopener noreferrer">
            <img src="${produto.imagemUrl}" alt="${produto.nome}" loading="lazy" />
            <h4>${produto.nome}</h4>
            <p>R$ ${produto.preco.toFixed(2)}</p>
          </a>
        `;
        gridProdutos.appendChild(div);
      }
    }

    // Filtra os produtos localmente por categoria e busca
    function filtrarProdutos() {
      let filtrados = produtos;

      if (filtroCategoria !== "todas") {
        filtrados = filtrados.filter(p => p.categoria === filtroCategoria);
      }

      if (buscaTermo.trim() !== "") {
        const termo = buscaTermo.toLowerCase();
        filtrados = filtrados.filter(p =>
          p.nome.toLowerCase().includes(termo) ||
          (p.descricao && p.descricao.toLowerCase().includes(termo))
        );
      }

      return filtrados;
    }

    // Pagina√ß√£o simples
    function paginar(lista, pagina, porPagina) {
      const inicio = (pagina - 1) * porPagina;
      return lista.slice(inicio, inicio + porPagina);
    }

    // Atualiza a p√°gina exibida
    function atualizarPagina() {
      const filtrados = filtrarProdutos();
      const paginados = paginar(filtrados, paginaAtual, produtosPorPagina);
      renderizarProdutos(paginados);

      pageInfo.textContent = `P√°gina ${paginaAtual}`;
      prevPageBtn.disabled = paginaAtual === 1;
      nextPageBtn.disabled = paginaAtual * produtosPorPagina >= filtrados.length;
    }

    // Eventos dos bot√µes
    prevPageBtn.onclick = () => {
      if (paginaAtual > 1) {
        paginaAtual--;
        atualizarPagina();
      }
    };
    nextPageBtn.onclick = () => {
      const filtrados = filtrarProdutos();
      if (paginaAtual * produtosPorPagina < filtrados.length) {
        paginaAtual++;
        atualizarPagina();
      }
    };

    // Captura o texto da busca e atualiza a lista
    buscaInput.addEventListener("input", (e) => {
      buscaTermo = e.target.value;
      paginaAtual = 1;
      atualizarPagina();
    });

    // Fun√ß√£o para carregar os produtos do Firestore
    async function carregarProdutos() {
      try {
        loadingSpinner.style.display = "block";
        const produtosSnapshot = await getDocs(collection(db, "produtos"));
        produtos = [];
        produtosSnapshot.forEach(doc => {
          produtos.push(doc.data());
        });
        atualizarPagina();
      } catch (error) {
        errorMessage.style.display = "block";
        errorMessage.textContent = "Erro ao carregar produtos.";
        console.error(error);
      } finally {
        loadingSpinner.style.display = "none";
      }
    }

    // Inicializa carregando produtos
    carregarProdutos();
  </script>
</body>
</html>
