<script>
  const cloudName = 'centrodecompra'; // seu cloud name
  const unsignedUploadPreset = 'ml_default'; // seu upload preset real

  const form = document.getElementById('form-produto');
  const imagemInput = document.getElementById('imagem');
  const preview = document.getElementById('preview');
  let imagemUrl = "";

  imagemInput.addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const formData = new FormData();
    formData.append('file', file);
    formData.append('upload_preset', unsignedUploadPreset);

    try {
      const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, {
        method: 'POST',
        body: formData
      });

      const data = await res.json();
      imagemUrl = data.secure_url;
      preview.src = imagemUrl;
      preview.style.display = 'block';
      console.log('Imagem enviada:', imagemUrl);
    } catch (err) {
      alert('Erro ao enviar imagem!');
      console.error(err);
    }
  });

  form.addEventListener('submit', (e) => {
    e.preventDefault();

    if (!imagemUrl) {
      alert('Aguarde o envio da imagem!');
      return;
    }

    const produto = {
      nome: document.getElementById('nome').value,
      descricao: document.getElementById('descricao').value,
      categoria: document.getElementById('categoria').value,
      preco: parseFloat(document.getElementById('preco').value),
      imagem: imagemUrl
    };

    console.log('Produto cadastrado:', produto);
    alert('Produto cadastrado com sucesso! Veja no console.');

    form.reset();
    preview.src = '';
    preview.style.display = 'none';
    imagemUrl = '';
  });
</script>
